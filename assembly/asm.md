# 汇编知识点

1. 指令
   1. 跳转指令
      * JMP $ ;进入死循环，因为已经设置好终端服务子程序，无所畏惧
      * JMP short label ; 占用两个字节，范围-128-127
      * JMP near label  ; 占用三个字节，范围-32768-32767
      * JMP far cs:ip   ; 可以在段之间跳转 例：`JMP 0x0：0x7C00`
   2. CLC
      * 将CF位清零
   3. ADC指令
      * 将原操作数和目的操作数和进位寄存器的值都加起来
   4. CALL指令
  
2. 8086内存划分用处

   |起始地址|结束地址|大小|用途|
   |-|-|-|-|
   |`0x000`|`0x3FF`|1KB|中断向量表|
   |`0x400`|`0x4FF`|256B|BIOS数据区|
   |`0x500`|`0x7BFF`|29.75KB|可用区域|
   |`0x7C00`|`0x7DFF`|512B|主引导扇区（MBR）|
   |`0x7E00`|`0x9FBFF`|607.6KB|可用区域|
   |`0x9FC00`|`0x9FFFF`|1KB|扩展BIOS数据区|
   |`0xA0000`|`0xAFFFF`|64KB|彩色显示适配器|
   |`0xB0000`|`0xB7FFF`|32KB|黑白显示适配器|
   |`0xB8000`|`0xBFFFF`|32KB|文本显示适配器|
   |`0xC0000`|`0xC7FFF`|32KB|显示适配器BIOS|
   |`0xC8000`|`0xEFFFF`|160KB|映射内存|
   |`0xF0000`|`0xFFFEF`|64KB-16B|系统BIOS|
   |`0xFFFF0`|`0xFFFFF`|16B|系统BIOS入口地址|

3. 控制字符背景

   * 高四位表示背景色：|K|R|G|B|
   * 低四位表示前景色：|I|R|G|B|
   * ---
   * K=0 ：背景不闪烁
   * k=1 ：背景闪烁
   * I=0 ：深色字符
   * I=1 ：浅色字符

      |Red|Green|Blue|Color|说明|
      |-|-|-|-|-|
      |0|0|0|Black||
      |0|0|1|Blue||
      |0|1|0|Green||
      |0|1|1|Cyan|青色|
      |1|0|0|Red||
      |1|0|1|Magenta|洋红|
      |1|1|0|Yellow||
      |1|1|1|White||
   * ---

4. 功能调用

   ```nasm
   mov ax, 3
   int 0x10; text mode. 80x25. 16 colors. 8 pages.
   ```

5. 标志寄存器

   |位|标志|英文|描述|
   |-|-|-|-|
   |0|CF|Carry|进位标志|
   |1||||
   |2|PF|Parity|奇偶标志|
   |3||||
   |4|AF|Auxiliary|辅助进位标志|
   |5||||
   |6|ZF|Zero|零标志|
   |7|SF|Sign|符号标志|
   |8|TF|Trap|陷阱标志|
   |9|IF|Interrupt|中断允许标志|
   |10|DF|Direction|方向标志|
   |11|0F|Overflow|溢出标志|

6. 堆栈-由高往低
   1. 栈顶的指针：`SS:SP`

7. 中断
   1. `0号中断`：除法异常
   2. `0x80号中断`：linux系统调用
   3. 内中断的使用
      1. 将要中断的地址写入到中断向量表中
      2. INT 中断向量表的地址
   4. 引发中断的过程
      1. 从中断信息处获得中断信息码
      2. 标志寄存器入栈
      3. 设置标志寄存器的IF & TF 位为0
      4. CS入栈
      5. IP入栈
      6. 读取程序入口地址设置IP和CS
   5. iret指令$\Leftrightarrow$
      ```nasm
      pop IP 
      pop CS 
      popf
      ```

   6. 单步中断
      - 单步中断：cpu执行完一条指令，如果Eflags中TF位为1，则会引发单步中断，单步中断的中断类型码为1，表现形式为显示所有寄存器内容后等待输入


8. 逻辑运算
   1. AND
   2. OR
   3. NOT
   4. XOR
   5. `TEST` 　与AND指令不同的地方在于他不会改变源操作数
   6. SHL 　　例：`SHL AL, 3` 逻辑移位指令，逻辑左移，最低位补0，最后移出的位进CF
   7. SHR 　　**补**：最高位补0
   8. ROL 　　例：`SHR AL, 3` 逻辑循环左移，最后移出的位复制到CF和AL第0位
   9. ROR
   10. RCL　　**解释**：带进位循环左移，`MSB->CF, CF'->LSB`
   11. SAL　　**解释**：算数左移，和SHL一模一样
   12. SAR　　**解释**：算数右移，最左边填充的是符号位的复制

9.  输入输出

```nasm
in al, dx
in ax, dx
out dx, al
out dx, ax  ;dx为端口号
```
